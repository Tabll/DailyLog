# 2019-9-2 周一

### 查询格式
类似于SELECT ...的可以修改为这种形式：
![](https://i.loli.net/2019/09/02/a2ijdPO9GAtCD5I.png)

# 2019-9-3 周二

##  表驱动法（Table-Driven Approach）
用数组代替if-else和switch-case语句  
*通过在表中查找信息，来代替很多复杂的if-else或者switch-case逻辑判断。这是一种设计的技巧，可以应用很多的场合，不仅可以提高程序的性能，也能大大减少代码量，使得代码变得高效和优雅*
> [用数组代替if-else和switch-case语句](https://blog.csdn.net/shudou/article/details/17663011) *shudou*  
> [浅析PHP数组的实现](https://www.jianshu.com/p/3f1d0f9907a1) *OamMot*

相关实现案例
```php
//判断是否闰年，若为闰年返回1，否则返回0
int IsLeapYear(unsigned int year)
{
	if ((0 == year % 4 && 0 != year % 100) || (0 == year % 400))
		return 1;
	return 0;
}
 
static unsigned int monthdays[2][12] = 
{
	{31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
	{31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
}
 
//获取year年month月的天数
unsigned int GetMonthDays(unsigned int year, unsigned int month)
{
	return monthdyas[IsYeapYear(year)][month - 1];
}
```

# 2019-9-4 周三

## Laravel 6.0 发布
> [官方文档](https://laravel.com/docs/6.0/releases)

## 注释
相关注释的格式和案例：
```php
/**
 * @api {get} /inner/attributes 属性列表
 * @api http://yapi.lanhanba.com:3000/project/36/interface/api/5892
 * @param  AttributeRequest  $request
 * @return AnonymousResourceCollection
 * @throws \Exception
 */
```
其中 `AnonymousResourceCollection`  
需要 `use Illuminate\Http\Resources\Json\AnonymousResourceCollection;`

## 缓存清理
**！重要**  
`php artisan cache:clear`
会返回
```
Cache cleared successfully.
```
其它缓存

`route cache`
```
$ php artisan route:cache
```
`config cache`
```
$ php artisan config:cache
```

# 2019-9-5 周四
变基时需要注意很多东西

# 2019-9-6 周五

**！早上需要运行 `php artisan cache:clear` 清理缓存**  
部分使用缓存的功能需要重置，否则数据为空

数据库执行超时
```
 Caused by
 Doctrine\DBAL\Driver\PDOException: SQLSTATE[HY000]: General error: 1205 Lock wait timeout exceeded; try restarting transaction
 ```
解决方法：  
执行
```sql
SHOW FULL PROCESSLIST;
```
![](https://i.loli.net/2019/09/06/irBGxqeTXVP1tQW.png)

查看当前的数据库链接情况，然后有阻塞的可以执行
```sql
KILL {Id}
```
可以临时解决阻塞问题

# 2019-9-7 周六
注释里的链接可以写成
`@link http://yapi.lanhanba.com:3000/project/36/interface/api/5892`
测试里的跳转可以写成
`@see AttributeController::index`

# 2019-9-9 周一
在测试顶部中可以使用以下注释，以忽略重名的类和未定义的方法
```php
<?php
/* @noinspection PhpUndefinedClassInspection */
/* @noinspection PhpUndefinedMethodInspection */
namespace Tests\Feature\Inner\V1;
use Tests\TestCase;
class CategoryControllerTest extends TestCase
{
	// 省略
}
?>
```

# 2019-9-10 周二
`function_exists` 函数  
*`function_exists ( string $function_name ) : bool` 如果给定的函数已经被定义就返回 `TRUE`*  
```php
if (!function_exists('combine_attributes')) {
    function combine_attributes($communityAttributes, $categoryAttributes)
	{
		// 省略
	}
}
```

# 2019-9-11 周三
bug修复一天

# 2019-9-12 周四
bug修复一天

# 2019-9-16 周一
部署时需要执行的命令在 `deployment/v3.15-depoly.sh` 文件下，格式如下：
```sh
#! /bin/bash
cd ./../
# 清空包缓存
php artisan clear-compiled
# 清空php代码缓存
php artisan opcache:clear
# 安装扩展
composer install --ignore-platform-reqs --prefer-dist --no-scripts --no-dev -o
# 优化 composer 生成 classmap
composer dump-autoload -o
# 缓存配置文件信息
php artisan config:cache
# 执行迁移文件
php artisan migrate
# 清除类目属性缓存
echo '清除类目属性缓存'
php artisan redis:clear --key=cate:*
```

# 2019-9-17 周二
