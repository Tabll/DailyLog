# 2019-8-12 周一
## 环境配置
```
PHPStorm
.NET Frameworks 4.7.1
SourceTree
XAMPP
Postman
```
## Apache 配置文件
### httpd.conf
需要更换目录

```
DocumentRoot "E:/www/LinhuibaServer/public"
<Directory "E:/www/LinhuibaServer/public">
```


### httpd-vhosts.conf
需要开启虚拟路由

```
<VirtualHost *:80>
ServerName lhb.com
ServerAlias sh.lhb.com sz.lhb.com hz.lhb.com
DocumentRoot "E:/www/LinhuibaServer/public"
DirectoryIndex demo.html index.php
 <Directory "E:/www/LinhuibaServer/public">
    Options +Indexes +FollowSymLinks +ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
 </Directory>
</VirtualHost>
```

## 项目配置文件
需要在 `public` 目录下添加 `.htaccess` 文件

## PHPStorm
- Laravel 插件
- .env files support 插件
- ldeolog 插件
- PHP代码风格设置，导入 `phpstorm.codestyle.xml`
- Composer 全局安装 `PHP CodeSniffer`
   ```
   composer global require "squizlabs/php_codesniffer=*"
   ```
- PHP 代码质量设置中选择 `Code Sniffer` 配置到本地文件路径：`C:\Users\Administrator\AppData\Roaming\Composer\vendor\bin\phpcs.bat`
-  勾选 Editor > Inspections > PHP > Quality Tools > PHP Code Sniffer Validation，`Coding standard` 选 `PSR2`”` 标准

# 2019-8-13 周二
## 请求筛选
```
    'task_attachments' => 'array|max:5',
    'task_attachments.*.name' => array(
        'required',
        'regex:/\.(png|jpg|jpeg|bmp|gif|pdf|xls|xlsx|doc|docx|ppt|pptx)$/'
    ),
```
PHP的正则表达式需要在两边套上 `/`

## 数据库查询
```
    ->when($taskListParameter->finish_to, function ($query) use ($taskListParameter) {
        $query->whereDate('tasks.updated_at', '<=', $taskListParameter->finish_to)
            ->where('tasks.status', '=', Task::TASK_STATUS_FINISHED);
    })
```
在这里使用定义的值：`Task::TASK_STATUS_FINISHED`，而不是 `3`

# 2019-8-14 周三

## 数据库查询日志
```
    ->when($taskListParameter->finish_from && $taskListParameter->finish_to, function ($query) use ($taskListParameter) {
        \DB::enableQueryLog();
        $query->whereHas('task_histories', function ($query) use ($taskListParameter) {
            $query->where(
                [
                    'task_histories.modified' => 'status',
                    'task_histories.new_value' => Task::TASK_STATUS_FINISHED
                ])
                ->whereDate('task_histories.updated_at', '>=', $taskListParameter->finish_from)
                ->whereDate('task_histories.updated_at', '<=', $taskListParameter->finish_to);
        })->get();
        print_r(\DB::getQueryLog());die();
    })
```
输出数据库执行查询的语句需要用

`\DB::enableQueryLog();`<br>
$query(***)`->get();`<br>
`print_r(\DB::getQueryLog());die();`<br>
以上查询的输出案例：
```
Array
(
[0] => Array
(
[query] => select * from `tasks` where exists (select * from `task_histories` where `tasks`.`id` =
`task_histories`.`task_id` and (`task_histories`.`modified` = ? and `task_histories`.`new_value` = ?) and
date(`task_histories`.`updated_at`) >= ? and date(`task_histories`.`updated_at`) <= ? and `task_histories`.`deleted_at`
	is null) and `tasks`.`deleted_at` is null [bindings]=> Array
	(
	[0] => status
	[1] => 3
	[2] => 2018-07-1
	[3] => 2018-07-5
	)

	[time] => 41.95
	)

	)
```
这部分代码最终修改为：
```
    ->when($taskListParameter->finish_from, function ($query) use ($taskListParameter) {
        $query->whereHas('task_histories', function ($query) use ($taskListParameter) {
            $query->where(
                [
                    'task_histories.modified' => 'status',
                    'task_histories.new_value' => Task::TASK_STATUS_FINISHED
                ]
            )
                ->whereDate('task_histories.updated_at', '>=', $taskListParameter->finish_from);
        });
    })
    ->when($taskListParameter->finish_to, function ($query) use ($taskListParameter) {
        $query->whereHas('task_histories', function ($query) use ($taskListParameter) {
            $query->where(
                [
                    'task_histories.modified' => 'status',
                    'task_histories.new_value' => Task::TASK_STATUS_FINISHED
                ]
            )
                ->whereDate('task_histories.updated_at', '<=', $taskListParameter->finish_to);
        });
    })
```

# 2019-8-15 周四

培训一天

### 公司价值：
`利他共赢` `使命 冒险 乐观 正直 开放 自省`

数据库迁移文件的建立：
```
php artisan make:migration add_is_user_edit_into_attributes
Created Migration: 2019_08_15_093544_add_is_user_edit_into_attributes
```
数据库迁移文件代码：
```
    public function up()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->tinyInteger('is_user_edit')->after('is_filter')->nullable(false)->comment('是否用户填写(0:不需要用户填写,1:需要用户填写)');
        });
    }

    public function down()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->dropColumn('is_user_edit');
        });
    }
```

# 2019-8-16 周五

培训一天，新员工入职培训结业->GET

昨天的迁移文件修改为
`2019_08_15_093544_add_is_user_edit_into_attributes.php`
```
    public function up()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->boolean('is_user_edit')
                ->after('is_filter')
                ->default(1)
                ->comment('是否用户填写(0:不需要用户填写,1:需要用户填写)');
        });
    }

    public function down()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->dropColumn('is_user_edit');
        });
    }
```
新增迁移文件
`2019_08_16_091903_add_remark_into_attributes.php`
```
    public function up()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->string('remark', 200)
                ->after('hint')
                ->nullable(true)
                ->comment('备注');
        });
    }

    public function down()
    {
        Schema::table('attributes', function (Blueprint $table) {
            $table->dropColumn('remark');
        });
    }
```

# 2019-8-17 周六

对于数据类型设置为boolean即长度为1的tinyint，请求验证这么写：<br>
`'is_user_edit' => 'required|integer|in:0,1',`

# 2019-8-18 周日


# 2019-8-19 周一


# 2019-8-20 周二